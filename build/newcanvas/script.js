!function(){"use strict";const e=(e,t)=>{if(t||(t=Z.ctx),t.globalCompositeOperation="eraser"===e.getAttribute("class")?"destination-out":"source-over","path"===e.nodeName){t.strokeStyle=e.getAttribute("stroke"),t.lineWidth=e.getAttribute("stroke-width"),t.beginPath();for(let o=0;o<e.pathSegList.numberOfItems;o++){const n=e.pathSegList.getItem(o);"M"===n.pathSegTypeAsLetter?t.moveTo(n.x,n.y):"L"===n.pathSegTypeAsLetter?t.lineTo(n.x,n.y):"Q"===n.pathSegTypeAsLetter?t.quadraticCurveTo(n.x1,n.y1,n.x,n.y):"C"===n.pathSegTypeAsLetter&&t.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y)}t.stroke()}else if("rect"===e.nodeName){t.fillStyle=e.getAttribute("fill");const o=e.getAttribute("x"),n=e.getAttribute("y"),a=e.getAttribute("width"),r=e.getAttribute("height");t.fillRect(o,n,a,r)}},t=e=>{Z.seekbarMove&&Z.seekbarMove(e)},o=o=>{if(Z.rewindCache.length>=Z.fastUndoLevels&&Z.rewindCache.pop(),Z.rewindCache.unshift(Z.ctx.getImageData(0,0,600,500)),e(o),Z.timeedit&&Z.position!==Z.svg.childNodes.length-1)Z.svg.insertBefore(o,Z.svg.childNodes[Z.position+1]);else{for(let e=Z.svg.childNodes.length-1;e>Z.position;e--)Z.svg.removeChild(Z.svg.childNodes[e]);Z.svg.appendChild(o),Z.position=Z.svg.childNodes.length-1,t(1)}},n=(e,t)=>{const o=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&Object.keys(t).forEach(e=>{t[e]&&o.setAttribute(e,t[e])}),o},a=e=>{o(n("rect",{class:e,x:0,y:0,width:600,height:500,fill:Z.background})),Z.lastrect=Z.position},r=()=>{let e=!1;for(let t=Z.svg.childNodes.length-1;t>0;t--){const o=Z.svg.childNodes[t];e||t>Z.position?Z.svg.removeChild(o):"rect"===o.nodeName&&t<=Z.position&&(e=!0,"eraser"===o.getAttribute("class")&&Z.svg.removeChild(o))}},i=(e,t,o,n)=>{const{ctxDisp:a}=Z;a.strokeStyle=Z.lastcolor,a.lineWidth=Z.size,a.beginPath(),a.moveTo(e,t),a.lineTo(o,n),a.stroke()},s=e=>{e&&Z.svgDisp.insertBefore(Z.path,Z.svgDisp.firstChild)},d=e=>"#"===e[0]?4===e.length?[...e.substr(1,3)+"F"].map(e=>parseInt(e+e,16)):(e+"FF").substr(1,8).match(/.{2}/g).map(e=>parseInt(e,16)):"rgba"===e.substr(0,4)?e.match(/[\d\.]+/g).map((e,t)=>3===t?Math.floor(255*parseFloat(e)):parseInt(e,10)):"rgb"===e.substr(0,3)?(e+255).match(/[\d\.]+/g).map(e=>parseInt(e,10)):[0,0,0,255],l=e=>"#"+e.map((e,t)=>t<3?("0"+e.toString(16)).slice(-2):"").join(""),c=e=>l(d(e)),f=e=>{const[t,o,n]=e.map(e=>e>10?Math.pow((e/255+.055)/1.055,2.4):e/255/12.92),[a,r,i]=[(.4124*t+.3576*o+.1805*n)/.95047,.2126*t+.7152*o+.0722*n,(.0193*t+.1192*o+.9505*n)/1.08883].map(e=>e>.008856?Math.pow(e,1/3):7.787*e+16/116);return[116*r-16,500*(a-r),200*(r-i)]},u=e=>document.getElementById(e),p=(e,t)=>{if(u("newcanvasyo").classList.contains("sandbox")||window.gameInfo&&window.gameInfo.friend)return l([...e]);const o=t.slice(0).map(t=>((e,t)=>{const o=f(e),n=f(t),a=n[0]-o[0],r=n[1]-o[1],i=n[2]-o[2];return Math.sqrt(a**2*2+r**2+i**2)})([...e],d(t))),n=Math.min(...o),a=t[o.indexOf(n)];return c(a)},g=(e,t)=>{const o=Z.ctx.getImageData(e,t,1,1).data;return o[3]>0?p(o,Z.palette):Z.background},h=e=>{e||(e=Z.svg.childNodes.length-1);for(let t=e;t>0;t--){if("rect"===Z.svg.childNodes[t].nodeName)return t}return 0},m=e=>String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e),b=e=>{const t="eraser"===e;Z.transparent=t,Z.canvas.style.background=t?"none":e,e=t?"#ffffff":c(e),Z.background=e,Z.svg.querySelectorAll(".eraser").forEach(t=>t.setAttribute("path"===t.nodeName?"stroke":"fill",e))},w=(e,t)=>{const{length:o}=e;if(o<2)return;if(t.pathSegList.initialize(t.createSVGPathSegMovetoAbs(e[0].x,e[0].y)),!window.options.smoothening){for(let o=1;o<e.length;o++)t.pathSegList.appendItem(t.createSVGPathSegLinetoAbs(e[o].x,e[o].y));return}if(t.pathSegList.appendItem(t.createSVGPathSegLinetoAbs(e[1].x,e[1].y)),o<3)return;let n;for(let a=1;a<o-1;a++){const o=e[a-1],r=e[a],i=e[a+1],s=r.x-o.x,d=r.y-o.y,l=Math.atan2(d,s),c=Math.sqrt(s**2+d**2),f=i.x-r.x,u=i.y-r.y,p=Math.atan2(u,f),g=Math.sqrt(f**2+u**2),h=(l+p)/2;if(a>1){let e=!1;if(Math.abs(p-l)>=Math.PI/4)t.pathSegList.appendItem(t.createSVGPathSegLinetoAbs(r.x,r.y));else if(e&&c/g>=.4&&c/g<=2.5){const e={x:o.x+Math.cos(n)*c*.4,y:o.y+Math.sin(n)*c*.4},a={x:r.x-Math.cos(h)*g*.4,y:r.y-Math.sin(h)*g*.4};t.pathSegList.appendItem(t.createSVGPathSegCurvetoCubicAbs(r.x,r.y,e.x,e.y,a.x,a.y))}else t.pathSegList.appendItem(t.createSVGPathSegLinetoAbs(r.x,r.y)),e=!0}n=h}const a=e[o-1];t.pathSegList.appendItem(t.createSVGPathSegLinetoAbs(a.x,a.y))},v=e=>new Uint8Array([...e].map(e=>e.charCodeAt(0))),y=(e,t)=>{const o=e<<8|t;return o>32767?o-65536:o},k=e=>{const{pako:t}=window,o=e[0];let a;if(4===o)e=t.inflate(e.subarray(1)),a=0;else if(3===o)e=v(t.inflate(e.subarray(1),{to:"string"})),a=0;else{if(2!==o)throw new Error(`Unsupported version: ${o}`);a=1}const r=n("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:600,height:500}),i={color:"#000000",size:14,x:0,y:0,pattern:0};let s=[];const d=`rgb(${e[a]}, ${e[a+1]}, ${e[a+2]})`;r.background=d,r.appendChild(n("rect",{class:"eraser",x:0,y:0,width:600,height:500,fill:d}));for(let t=a+4;t<e.length;){let o=y(e[t],e[t+1]),a=y(e[t+=2],e[t+1]);if(t+=2,s.length)if(o||a)i.x=o+=i.x,i.y=a+=i.y,s.push({x:o,y:a});else{const e=n("path",{class:"eraser"===i.color?i.color:null,stroke:"eraser"===i.color?d:i.color,"stroke-width":i.size,"stroke-linejoin":"round","stroke-linecap":"round",fill:"none"});1===s.length?(e.pathSegList.appendItem(e.createSVGPathSegMovetoAbs(i.x,i.y)),e.pathSegList.appendItem(e.createSVGPathSegLinetoAbs(i.x,i.y+.001))):w(s,e),e.orig=s,e.pattern=i.pattern,r.appendChild(e),s=[]}else o<0?-1===o||-2===o?(i.color=`rgba(${e[t]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]/255}`,"rgba(255,255,255,0)"===i.color&&(i.color="eraser"),t+=4,-1===o?i.size=a/100:r.appendChild(n("rect",{class:"eraser"===i.color?i.color:null,x:0,y:0,width:600,height:500,fill:"eraser"===i.color?d:i.color}))):-3===o&&(i.pattern=a,t+=4):(s.push({x:o,y:a}),i.x=o,i.y=a)}return r},L=()=>[...Z.svg.childNodes].splice(Z.lastrect<Z.position?Z.lastrect:0).forEach(t=>e(t)),S=e=>{const o=new DataView(e),n=o.getUint32(0);if(2303741511!==n)throw new Error(`Invalid PNG format: ${m(n)}`);for(let n=8;n<e.byteLength;n+=4){const a=o.getUint32(n);n+=4;const r=m(o.getUint32(n));if(n+=4,"svGb"===r)return Z.svg=k(new Uint8Array(e,n,a)),Z.lastrect=0,Z.rewindCache.length=0,Z.position=Z.svg.childNodes.length-1,L(),t(1),void b(Z.svg.background);if("IEND"===r)break;n+=a}throw new Error("No vector data found!")},C=()=>{Z.fileInput||(Z.fileInput=document.createElement("input"),Z.fileInput.style.position="absolute",Z.fileInput.style.top="-1000px",Z.fileInput.type="file",Z.fileInput.accept=".png",document.body.appendChild(Z.fileInput),Z.fileInput.addEventListener("change",e=>{const t=new FileReader;t.onload=()=>S(t.result),e.currentTarget.files[0]&&t.readAsArrayBuffer(e.currentTarget.files[0])},!1)),Z.fileInput.click()},A=e=>{const t=new XMLHttpRequest;if(t.open("GET",e,!0),!("responseType"in t))return alert("Your browser is too old for this");t.responseType="arraybuffer",t.onload=()=>S(t.response),t.send()},x=()=>Z.svg.childNodes.length-1,E=(e,t)=>{Z.locked||(Z.brushCursor||(Z.brushCursor=n("circle",{"stroke-width":"1",stroke:"#000",fill:"none"}),Z.svgDisp.appendChild(Z.brushCursor),Z.brushCursor2=n("circle",{"stroke-width":"1",stroke:"#fff",fill:"none"}),Z.svgDisp.appendChild(Z.brushCursor2),Z.eyedropperCursor=n("image",{width:16,height:16,visibility:"hidden"}),Z.eyedropperCursor.setAttributeNS("http://www.w3.org/1999/xlink","href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAARklEQVR4XoXRwQoAIAgEUf//pzeGDgq5G3PrCQqVbIAqsDz9WM2qhTX4GZgPV+JpSFxAC0PwbeVZZIpMgXvAMwoj4U9B3wGySxvzk6ZjvwAAAABJRU5ErkJggg=="),Z.svgDisp.appendChild(Z.eyedropperCursor)),void 0!==e&&(Z.brushCursor.setAttribute("cx",e),Z.brushCursor.setAttribute("cy",t),Z.brushCursor2.setAttribute("cx",e),Z.brushCursor2.setAttribute("cy",t),Z.eyedropperCursor.setAttribute("x",e-1),Z.eyedropperCursor.setAttribute("y",t-15)),Z.brushCursor.setAttribute("r",Z.size/2+.5),Z.brushCursor2.setAttribute("r",Z.size/2-.5))},D=(e,t,o)=>{let{x:n,y:a}=t,r=o.x-n,i=o.y-a;if(0!==r||0!==i){var s=((e.x-n)*r+(e.y-a)*i)/(r*r+i*i);s>1?(n=o.x,a=o.y):s>0&&(n+=r*s,a+=i*s)}return(r=e.x-n)*r+(i=e.y-a)*i},T=()=>{if(Z.locked)return;Z.unsaved=!0;const e=Z.points.length>2?(({points:e,smoothening:t})=>{const o=e.length,n=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(o);let a=0,r=o-1;const i=[],s=[];for(n[a]=n[r]=1;r;){let o,s=0;for(let t=a+1;t<r;t++){let n=D(e[t],e[a],e[r]);n>s&&(o=t,s=n)}s>t&&(n[o]=1,i.push(a,o,o,r)),r=i.pop(),a=i.pop()}for(let t=0;t<o;t++)n[t]&&s.push(e[t]);return s})(Z):Z.points;w(e,Z.path),Z.path.orig=e,o(Z.path),Z.ctxDisp&&Z.ctxDisp.clearRect(0,0,600,500),Z.isStroking=!1},I=()=>{Z.isStroking&&T(),Z.locked=!0,E(-100,-100)},N=(e,t)=>{const o=(()=>{const e=[];for(let t=0;t<256;t++){let o=t;for(let e=0;e<8;e++)o=1&o?3988292384^o>>>1:o>>>1;e.push(o)}return e})();let n=-1;for(let t=0;t<e.length;t++)n=n>>>8^o[255&(n^e.charCodeAt(t))];if(t)for(let e=0;e<t.length;e++)n=n>>>8^o[255&(n^t.charCodeAt(e))];return(-1^n)>>>0},P=e=>d(e).map(e=>String.fromCharCode(e)).join(""),M=e=>String.fromCharCode(e>>8&255,255&e),_=e=>{const{pako:t}=window,o=[P(Z.background)],n={color:P("#000000"),size:14,x:-1,y:-1,pattern:0};return e.childNodes.forEach(e=>{if("path"===e.nodeName){const t="eraser"===e.getAttribute("class")?"ÿÿÿ\0":P(e.getAttribute("stroke")),a=e.getAttribute("stroke-width"),r=e.pattern||0;t===n.color&&a===n.size||(o.push(M(-1)),o.push(M(100*a)),o.push(t),n.color=t,n.size=a),r!==n.pattern&&(o.push(M(-3)),o.push(M(r)),o.push("\0\0\0\0"),n.pattern=r),n.x=e.orig[0].x,n.y=e.orig[0].y,o.push(M(n.x)),o.push(M(n.y));for(let t=1;t<e.orig.length;t++){const a=e.orig[t].x-n.x,r=e.orig[t].y-n.y;(a||r)&&(o.push(M(a)),o.push(M(r)),n.x=e.orig[t].x,n.y=e.orig[t].y)}o.push("\0\0\0\0")}else{if("rect"!==e.nodeName)throw new Error("Unknown node name: "+e.nodeName);{const t=P(e.getAttribute("fill"));o.push(M(-2)),o.push(M(0)),o.push(t)}}}),""+(e=>[...e].map(e=>String.fromCharCode(e)).join(""))(t.deflate(v(o.join(""))))},B=(o,n,a)=>{r(),t(1);const i=document.createElement("canvas");i.width=o,i.height=n;const s=i.getContext("2d");if(Z.transparent||(s.fillStyle=Z.background,s.fillRect(0,0,o,n)),a)s.drawImage(Z.canvas,0,0,o,n);else{s.lineJoin=s.lineCap="round",s.scale(o/600,n/500);for(let t=0;t<Z.svg.childNodes.length;t++)e(Z.svg.childNodes[t],s)}Z.pngBase64=i.toDataURL("image/png");const d="svGb",l=_(Z.svg),c=Z.pngBase64.substr(-2),f="=="===c?1:"="===c[1]?2:3,u=atob(Z.pngBase64.substr(-20)).substr(f),p=[atob(Z.pngBase64.substr(-20)).substr(0,f),m(l.length),d,l,m(N(d,l)),u].join("");Z.pngBase64=Z.pngBase64.substr(0,Z.pngBase64.length-20)+btoa(p)},$=o=>{Z.isPlaying&&(Z.isAnimating&&(Z.isAnimating=!1,Z.svgDisp.removeChild(Z.path),e(Z.animatePath),Z.position++,o||t(Z.position/(Z.svg.childNodes.length-1))),Z.isPlaying=!1)},j=()=>{if(!Z.isPlaying)return;const o=Z.svg.childNodes.length-1;let{delay:n}=Z,a=0;if(Z.position<o||Z.isAnimating)if(Z.isAnimating){if(a=Z.animatePath.pathSegList.numberOfItems-1,Z.animateIndex<a){const e=Z.animatePath.pathSegList.getItem(Z.animateIndex),t="L"===e.pathSegTypeAsLetter?Z.path.createSVGPathSegLinetoAbs(e.x,e.y):"Q"===e.pathSegTypeAsLetter?Z.path.createSVGPathSegCurvetoQuadraticAbs(e.x,e.y,e.x1,e.y1):"C"===e.pathSegTypeAsLetter&&Z.path.createSVGPathSegCurvetoCubicAbs(e.x,e.y,e.x1,e.y1,e.x2,e.y2);Z.path.pathSegList.appendItem(t),Z.animateIndex++}else Z.isAnimating=!1,Z.svgDisp.removeChild(Z.path),e(Z.animatePath),Z.position++,Z.animateIndex=0;n/=6}else{const t=Z.svg.childNodes[Z.position+1];if("path"===t.nodeName){Z.isAnimating=!0,Z.animatePath=t,Z.animateIndex=1,Z.path=t.cloneNode(!0);const e=t.pathSegList.getItem(0);Z.path.pathSegList.initialize(Z.path.createSVGPathSegMovetoAbs(e.x,e.y)),Z.svgDisp.insertBefore(Z.path,Z.svgDisp.firstChild)}else e(t),Z.position++}t((Z.position+(a?Z.animateIndex/a:0))/o),Z.position<o?setTimeout(Z.playTimer,n):$()},O=()=>{if(!Z.locked){if(Z.rewindCache.length=0,Z.position===Z.svg.childNodes.length-1){if(0===Z.position)return t(1);Z.position=0,t(0),e(Z.svg.childNodes[0])}Z.isPlaying=!0,j()}},G=t=>{if(Z.locked)return;let o=-1;if($(!0),t!==Z.position){if(t<Z.position){const n=Z.position-t;n<=Z.rewindCache.length?(Z.ctx.putImageData(Z.rewindCache[n-1],0,0),Z.rewindCache.splice(0,n)):(o=0,o=Z.lastrect<=t?Z.lastrect:h(t),e(Z.svg.childNodes[o]))}else t>Z.position&&(o=Z.position);if(-1!==o){if(t-o>=Z.fastUndoLevels)Z.rewindCache.length=0;else{const{length:e}=Z.rewindCache,n=Math.min(e,t-o+e-Z.fastUndoLevels);Z.rewindCache.splice(e-n,n)}for(let n=o+1;n<=t;n++)t-n<Z.fastUndoLevels&&Z.rewindCache.unshift(Z.ctx.getImageData(0,0,600,500)),e(Z.svg.childNodes[n])}Z.position=t}},z=()=>{if(!Z.locked){var e=Z.svg.childNodes.length-1;Z.position<e&&(G(Z.position+1),t(Z.position/e))}},R=(e,t)=>{if(e||(e=Z.pngBase64,t=".png",Z.unsaved=!1),Z.saveLink||(Z.saveLink=document.createElement("a"),document.body.appendChild(Z.saveLink)),"download"in Z.saveLink){Z.saveLink.href=e;const o=new Date;Z.saveLink.download=["DrawingInTime_",o.getFullYear(),"_",(101+o.getMonth()+"").slice(-2),(100+o.getDate()+"").slice(-2),"_",(100+o.getHours()+"").slice(-2),(100+o.getMinutes()+"").slice(-2),(100+o.getSeconds()+"").slice(-2),t].join(""),Z.saveLink.click()}else window.open(e);return!0},H=(e,t)=>Z.colors[e]=t,V=e=>Z.seekbarMove=e,U=e=>{Z.size=e,E()},q=e=>{if(!Z.brushCursor)return;const t=e?"hidden":"visible",o=e?"visible":"hidden";Z.brushCursor.setAttribute("visibility",t),Z.brushCursor2.setAttribute("visibility",t),Z.eyedropperCursor.setAttribute("visibility",o)},K=(e,t)=>{if(Z.locked)return;if(!Z.isStroking)throw new Error("StrokeAdd without StrokeBegin!");const o=Z.points[Z.points.length-1];o.x===e&&o.y===t||(Z.blot&&(Z.path.pathSegList.removeItem(1),Z.blot=!1),Z.path.pathSegList.appendItem(Z.path.createSVGPathSegLinetoAbs(e,t)),navigator.userAgent.match(/\bPresto\b/)?s(!1):i(o.x,o.y,e,t),Z.points.push({x:e,y:t}))},Y=(e,t,o)=>{if(Z.locked)return;o?Z.lastleft=o:o=Z.lastleft;let a=o?Z.colors[0]:Z.colors[1];const r="eraser"===a?a:null;a="eraser"===a?Z.background:a,Z.path=n("path",{class:r,stroke:a,"stroke-width":Z.size,"stroke-linejoin":"round","stroke-linecap":"round",fill:"none"}),Z.lastcolor=a,Z.path.pattern=Z.pattern,Z.path.pathSegList.appendItem(Z.path.createSVGPathSegMovetoAbs(e,t)),Z.path.pathSegList.appendItem(Z.path.createSVGPathSegLinetoAbs(e,t+.001)),navigator.userAgent.match(/\bPresto\b/)?s(!0):i(e,t,e,t+.001),Z.points=[],Z.points.push({x:e,y:t}),Z.blot=!0,Z.isStroking=!0},X=()=>{Z.locked||Z.position>0&&(G(Z.position-1),t(Z.position/(Z.svg.childNodes.length-1)))},F=()=>Z.locked=!1,J=e=>v(atob(e)),W=e=>{const t=new XMLHttpRequest;t.open("POST","https://api.imgur.com/3/image"),t.onload=()=>{let o=t.responseText;try{o=JSON.parse(o)}catch(e){}if(o.success){const e=new XMLHttpRequest;e.open("POST","https://api.imgur.com/3/image/"+o.data.deletehash),e.setRequestHeader("Authorization","Client-ID 4809db83c8897af");const t=new FormData;t.append("description","Playback: http://grompe.org.ru/drawit/#"+o.data.id),e.send(t)}e(o)},t.onerror=t=>e(`error: ${t}`),t.setRequestHeader("Authorization","Client-ID 4809db83c8897af");const o=new FormData;o.append("image",new Blob([J(Z.pngBase64.substr(22)).buffer],{type:"image/png"})),o.append("type","file"),o.append("title","Made with Drawing in Time"),o.append("description","http://grompe.org.ru/drawit/"),t.send(o)},Q={Normal:["#000000","#444444","#999999","#ffffff","#603913","#c69c6d","#ffdab9","#ff0000","#ffd700","#ff6600","#16ff00","#0fad00","#00ffff","#0247fe","#ec008c","#8601af","#fffdc9"],Sepia:["#402305","#503315","#604325","#705335","#806345","#907355","#a08365","#b09375","#bfa284","#cfb294","#dfc2a4","#ffe2c4"],Grayscale:["#000000","#ffffff","#151515","#2a2a2a","#3f3f3f","#555555","#6a6a6a","#7f7f7f","#949494","#aaaaaa","#bfbfbf","#d4d4d4","#e9e9e9"],"Black and white":["#ffffff","#000000"],CGA:["#555555","#000000","#0000aa","#5555ff","#00aa00","#55ff55","#00aaaa","#55ffff","#aa0000","#ff5555","#aa00aa","#ff55ff","#aa5500","#ffff55","#aaaaaa","#ffffff"],Gameboy:["#8bac0f","#9bbc0f","#306230","#0f380f"],Neon:["#ffffff","#000000","#adfd09","#f3f315","#feac09","#fe0bab","#ad0bfb","#00abff"],Thanksgiving:["#673718","#3c2d27","#c23322","#850005","#c67200","#77785b","#5e6524","#cfb178","#f5e9ce"],Holiday_old:["#3d9949","#7bbd82","#7d1a0c","#bf2a23","#fdd017","#00b7f1","#bababa","#ffffff"],"Valentine's":["#2d1014","#ffffff","#600d17","#c2113a","#b71d1d","#e54d5a","#ff7d63","#fd8647","#fed067","#ffe4b7","#fdc0c6"],Halloween:["#444444","#000000","#999999","#ffffff","#603913","#c69c6d","#7a0e0e","#b40528","#fd2119","#fa5b11","#faa611","#ffd700","#602749","#724b97","#bef202","#519548","#b2bb1e"],"the blues":["#b6cbe4","#618abc","#d0d5ce","#82a2a1","#92b8c1","#607884","#c19292","#8c2c2c","#295c6f"],Spring:["#9ed396","#57b947","#4d7736","#365431","#231302","#3e2409","#a66621","#a67e21","#ebbb49","#ffc0cb","#ffffff"],Beach:["#1ca4d2","#65bbe2","#6ab7bf","#94cbda","#9cbf80","#d2e1ab","#b8a593","#d7cfb9","#dc863e","#f7dca2"],"Tide Pool":["#ffe8b9","#fad489","#ffb44c","#d6b1de","#b197a8","#e5f2ff","#a1ffb8","#53e6ef","#3ad3a8","#1ca4d2","#2271a2"],"Colors of 2016":["#91a7d0","#f6cac9","#eb9587","#776a5f","#d1c2ab","#a39d9d","#648589"],Bee:["#000000","#7a5c00","#b58800","#eab618","#f6de97","#ffffff"],"Colors of 2017":["#86af49","#44883d","#1f4478","#0062a3","#00939a","#59c9d5","#8a9a9a","#5f7278"],"Fire and Ice":["#520909","#b40528","#fd2119","#faa611","#ffe96a","#ffffff","#69ddff","#1c8ae5","#0a3fa9","#040526"],"Canyon Sunset":["#fce3ca","#feb789","#f27c8a","#af5081","#8e6dae","#5f4a8b","#2e1b50"],Juice:["#f3ab54","#ec5e66","#ab5871","#f2a19b","#f9f4d4","#fadfb7","#869e3c","#cbdd7e","#fced95"],Tropical:["#f68357","#fbc040","#fefa56","#fef0f5","#90fc51","#07f182","#1d6ab2","#12041b","#2f0946"],"Grimby Grays":["#000000","#ffffff","#2f3032","#252422","#545758","#4b4a46","#797d80","#71706c","#9ea1a4","#979692","#c4c8cb","#d7d6d2","#dee1e4","#f0efeb"],"DawnBringer 16":["#140c1c","#442434","#30346d","#4e4a4e","#854c30","#346524","#d04648","#757161","#597dce","#d27d2c","#8595a1","#6daa2c","#d2aa99","#6dc2ca","#dad45e","#deeed6"],"Fury Road":["#020c16","#023745","#08616d","#36d4b6","#0afef6","#fce173","#e29f30","#b56942","#ad3f16","#893f1d"],Candy:["#06063c","#4f95ff","#68f9ff","#fffef9","#ff96f8","#ff44d3","#793abd"],Holiday:["#e91434","#97200a","#c66a20","#fdbe30","#688625","#004f28","#112825","#1c69bf","#6096d3","#a5c4e6","#f7d9f0","#f6f6f6"],Blues:["#929aa8","#896868","#546c7d","#633d3d","#284660","#421f29","#232e3f","#0f1328"],"Sin City":["#ffffff","#ff0000","#000000"],"Lucky Clover":["#ffffff","#fcf4c4","#f7b307","#fc8404","#cd7a14","#9bf23e","#40d910","#34900b","#0c442c"],"D's Exclusive":["#000000","#717474","#ffffff","#f25b99","#e4965e","#ffc416","#ffe38f","#0074d9","#09a3ec","#12d1ff","#bcf5ff","#0ee446"],"Retina Burn":["#bc0bff","#ff0b11"],Easter:["#9678ba","#bc9ff0","#e4ccff","#ffa1f1","#fbd0ee","#e6f2ff","#aaedfb","#f4dc7b","#fdfabd","#a1ef85","#ddf7a8"],Neapolitan:["#3f3245","#ff5c98","#ecb2a4","#fff7e1"],Lemonade:["#645f87","#37aab4","#8ce6c3","#d7ffb4","#ff7d91","#ffaaa5","#ffd2af","#ffebaa"],"School Pen":["#07207a","#000000","#d8110c","#097536","#fbfcfd"]},Z={container:null,svg:n("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"600",height:"500"}),canvas:document.createElement("canvas"),canvasDisp:document.createElement("canvas"),svgDisp:n("svg",{version:"1.1",width:"600",height:"500","pointer-events":"none"}),svgHist:null,path:null,points:null,pngBase64:null,lastrect:0,position:0,isStroking:!1,isPlaying:!1,size:14,smoothening:1,palette:Q.Normal,patternCache:{},delay:100,unsaved:!1,background:"#fffdc9",transparent:!1,colors:["#000000","eraser"],fastUndoLevels:10,rewindCache:[],bindContainer:e=>{Z.container=e,Z.canvas.width=600,Z.canvas.height=500,Z.canvas.style.background=Z.background,Z.ctx=Z.canvas.getContext("2d"),Z.ctx.lineJoin=Z.ctx.lineCap="round",Z.container.appendChild(Z.canvas),navigator.userAgent.match(/\bPresto\b/)?Z.DrawDispLine=Z.DrawDispLinePresto:(Z.canvasDisp.width=600,Z.canvasDisp.height=500,Z.ctxDisp=Z.canvasDisp.getContext("2d"),Z.ctxDisp.lineJoin=Z.ctxDisp.lineCap="round",Z.container.appendChild(Z.canvasDisp)),Z.container.appendChild(Z.svgDisp);const t=n("rect",{class:"eraser",x:0,y:0,width:600,height:500,fill:Z.background});Z.svg.appendChild(t)},packPlayback:_,unpackPlayback:k,findLastRect:h,cutHistoryBeforeClearAndAfterPosition:r,makePng:B,fromPng:S,fromUrl:A,fromLocalFile:C,setBackground:b,setColor:H,setSize:U,drawSvgElement:e,updateView:L,drawDispLinePresto:s,drawDispLine:i,strokeBegin:Y,strokeEnd:T,strokeAdd:K,clearWithColor:a,addToSvg:o,undo:X,redo:z,moveSeekbar:t,setSeekbarMove:V,getSeekMax:x,seek:G,play:O,playTimer:j,pause:$,moveCursor:E,showEyedropperCursor:q,eyedropper:g,requestSave:R,uploadToImgur:W,lock:I,unlock:F},ee={rectangle:{},touchSingle:!1,lastTouch:{},lastSeenColorToHighlight:Z.background,brushSizes:[2,6,14,42],timerStart:0},te=e=>{e.preventDefault();const t=[...e.currentTarget.classList].filter(e=>e.startsWith("size-"))[0].match(/\d+/)[0];U(t);const o=u("tools").querySelector(".sel");if(o&&o.classList.remove("sel"),e.currentTarget.classList.add("sel"),!Z.isStroking)return;T();const n=Z.points[Z.points.length-1];Y(n.x,n.y)},oe=e=>{e.preventDefault(),u("play").classList.remove("pause"),z()},ne=e=>{ee.chooseBackground=e,e?(u("colors").classList.add("setbackground"),u("setbackground").classList.add("sel")):(u("colors").classList.remove("setbackground"),u("setbackground").classList.remove("sel"))},ae=e=>{e.preventDefault(),ne(!ee.chooseBackground)},re=e=>{e.preventDefault(),a("eraser"),u("newcanvasyo").classList.contains("sandbox")&&(ee.timerStart=Date.now())},ie=e=>{e.preventDefault(),u("play").classList.remove("pause"),X()},se=()=>u("wacom")&&u("wacom").penAPI&&u("wacom").penAPI.isWacom?u("wacom").penAPI.pointerType:0,de=()=>{const{colors:e}=Z;["primary","secondary"].forEach((t,o)=>{"eraser"===e[o]?(u(t).style.backgroundColor="pink",u(t).classList.add("eraser")):(u(t).style.backgroundColor=e[o],u(t).classList.remove("eraser"))})},le=e=>{if(e.touches||0===e.button||2===e.button){e.preventDefault();const t=e.currentTarget;let o=t.style.backgroundColor;ee.chooseBackground?("eraser"!==t.id&&b(o),ne(!1)):("eraser"===t.id&&(o="eraser"),2===e.button||3===se()?H(1,o):H(0,o),de())}},ce=e=>{e.stopPropagation(),e.preventDefault(),Z.isPlaying?(u("play").classList.remove("pause"),$()):(u("play").classList.add("pause"),O())},fe=e=>{e.altKey||(e.currentTarget.classList.remove("hidecursor"),q(!1),e.currentTarget.removeEventListener("mousemove",fe))},ue=e=>{const{options:t}=window;if(document.activeElement instanceof HTMLInputElement)return!0;if(18===e.keyCode)navigator.userAgent.match(/\bPresto\b/)||u("svgContainer").classList.add("hidecursor"),q(!0),u("svgContainer").addEventListener("mousemove",fe);else if(e.keyCode==="Q".charCodeAt(0))e.preventDefault(),t.colorDoublePress=!t.colorDoublePress;else if(e.keyCode==="Z".charCodeAt(0)||8===e.keyCode&&Z.unsaved)e.preventDefault(),u("play").classList.remove("pause"),X();else if(e.keyCode==="Y".charCodeAt(0))e.preventDefault(),u("play").classList.remove("pause"),z();else if(e.keyCode==="X".charCodeAt(0)){e.preventDefault();const[t,o]=Z.color;H(0,o),H(1,t),de()}else if(e.keyCode==="B".charCodeAt(0)){if(u("setbackground").hidden)return;e.preventDefault(),ne(!ee.chooseBackground)}else if(e.keyCode!=="E".charCodeAt(0)||e.ctrlKey||e.metaKey)if(e.keyCode>=48&&e.keyCode<=57&&!e.ctrlKey&&!e.metaKey&&t.colorNumberShortcuts){e.preventDefault();let o=48===e.keyCode?9:e.keyCode-49;(e.shiftKey||t.colorDoublePress&&Z.prevColorKey===o)&&(o+=8),Z.prevColorKey=o,t.colorDoublePress&&(Z.prevColorKeyTimer&&clearTimeout(Z.prevColorKeyTimer),Z.prevColorKeyTimer=setTimeout(()=>Z.prevColorKey=-1,500));const n=u("colors").querySelectorAll("b");if(o<n.length){const e="eraser"===n[o].id?"eraser":n[o].style.backgroundColor;ee.chooseBackground?("eraser"!==e&&b(e),ne(!1)):(H(0,e),de())}if(Z.isStroking){T();const e=Z.points[Z.points.length-1];Y(e.x,e.y)}}else if(189!==e.keyCode&&219!==e.keyCode&&188!==e.keyCode||e.ctrlKey||e.metaKey)if(187!==e.keyCode&&221!==e.keyCode&&190!==e.keyCode||e.ctrlKey||e.metaKey)e.keyCode>=49&&e.keyCode<=52&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),u("brush"+(e.keyCode-49)).click()):32!==e.keyCode||!e.ctrlKey&&!e.metaKey||e.altKey||e.shiftKey||ce(e);else{e.preventDefault();for(let e=0;e<ee.brushSizes.length-1;e++)if(Z.size-ee.brushSizes[e]<.01){u("brush"+(e+1)).click();break}}else{e.preventDefault();for(let e=1;e<ee.brushSizes.length;e++)if(Z.size-ee.brushSizes[e]<.01){u("brush"+(e-1)).click();break}}else e.preventDefault(),H(0,"eraser"),de()},pe=e=>{18===e.keyCode&&(u("svgContainer").classList.remove("hidecursor"),q(!1))},ge=()=>{if(Z.position<x())return!confirm("Strokes after current position wi)ll be discarded. Continue?")},he=e=>{e.preventDefault(),ge()||(B(600,500,!0),R())},me=e=>{e.preventDefault(),u("svgContainer").classList.add("loading"),C(),u("svgContainer").classList.remove("loading")},be=e=>{e.preventDefault(),ge()||(u("imgur").childNodes[0].nodeValue="Uploading...",u("imgur").disabled=!0,B(600,500,!0),W(e=>{if(u("imgur").childNodes[0].nodeValue="Upload to imgur",u("popup").classList.add("show"),u("popuptitle").childNodes[0].nodeValue="Imgur upload result",e&&e.success)Z.unsaved=!1,u("imgururl").href=`http://imgur.com/${e.data.id}`,u("imgururl").childNodes[0].nodeValue="Uploaded image",u("imgurdelete").href=`http://imgur.com/delete/${e.data.deletehash}`,u("imgurerror").childNodes[0].nodeValue="",window.inforum&&(window.frameElement.ownerDocument.getElementById("input-comment").value+=`![](http://i.imgur.com/${e.data.id}.png)`);else{const t=e.data?`Imgur error: ${e.data.error}`:`Error: ${e}`;u("imgurerror").childNodes[0].nodeValue=t}u("imgur").disabled=!1}))},we=e=>{e.preventDefault();const t=x();let o=e.touches?e.touches[0].pageX-ee.rectangle.left-34:e.pageX-ee.rectangle.left-pageXOffset-34;o=Math.min(Math.max(-10,o),492);const n=Math.round((o+10)/502*t);o=n/t*502-10,u("knob").classList.add("smooth"),u("knob").style.marginLeft=o+"px",G(n),u("play").classList.remove("pause")},ve=e=>{e.button&&(e.touches||e.touches.length)||(e.preventDefault(),window.removeEventListener("mouseup",ve),window.removeEventListener("touchend",ve),window.removeEventListener("mousemove",we),window.removeEventListener("touchmove",we))},ye=e=>{(0===e.button||e.touches&&1===e.touches.length)&&(ee.rectangle=u("seekbar").getBoundingClientRect(),we(e),window.addEventListener("mouseup",ve),window.addEventListener("touchend",ve),window.addEventListener("mousemove",we),window.addEventListener("touchmove",we))},ke=e=>{const t=Math.floor(502*e-10);e>0?u("knob").classList.add("smooth"):u("knob").classList.remove("smooth"),u("knob").style.marginLeft=t+"px",e>=1&&u("play").classList.remove("pause")},Le=e=>e.preventDefault(),Se=e=>{u("palettename").childNodes[0].nodeValue=e;const t=Q[e];Z.palette=t;const o=u("palette"),n=o.querySelectorAll("b");n.forEach(e=>o.removeChild(e));const a=n[n.length-1];t.forEach(e=>{const t=document.createElement("b");t.style.backgroundColor=e,t.addEventListener("mousedown",le),t.addEventListener("touchend",le),t.addEventListener("contextmenu",Le),o.appendChild(t),o.appendChild(a)})},Ce=e=>{if(e.touches||0===e.button){e.preventDefault();const t=e.currentTarget.childNodes[0].nodeValue;Se(t)}},Ae=e=>{(e.touches||0===e.button)&&(u("palettechooser").classList.remove("open"),window.removeEventListener("mousedown",Ae),window.removeEventListener("touchend",Ae))},xe=e=>{if(e.touches||0===e.button){e.preventDefault();const t=u("palettechooser");t.classList.toggle("open"),t.classList.contains("open")&&setTimeout(()=>{window.addEventListener("mousedown",Ae),window.addEventListener("touchend",Ae)},1);const o=Object.keys(Q);if(t.childNodes.length<o.length){const e=document.createElement("canvas");e.height=10;const n=e.getContext("2d");for(let a=t.childNodes.length;a<o.length;a++){e.width=8*Q[o[a]].length+2,n.clearRect(0,0,e.width,e.height),n.globalAlpha=.5,n.fillRect(0,0,e.width,e.height),n.globalAlpha=1,Q[o[a]].forEach((e,t)=>{n.fillStyle=e,n.fillRect(8*t+1,1,8,8)});const r=document.createElement("div");r.appendChild(document.createTextNode(o[a])),r.style.backgroundImage=`url("${e.toDataURL()}")`,r.style.backgroundRepeat="no-repeat",r.style.backgroundPosition="center 35px",r.addEventListener("mousedown",Ce),r.addEventListener("touchend",Ce),t.appendChild(r)}}}},Ee=e=>{e.preventDefault(),u("popup").classList.remove("show")},De=e=>e.preventDefault(),Te=()=>!!Z.isPlaying&&($(),u("play").classList.remove("pause"),!0),Ie=e=>{if(e.preventDefault(),!Z.isStroking)return;const t=e.pageX-ee.rectangle.left-pageXOffset,o=e.pageY-ee.rectangle.top-pageYOffset;K(t,o)},Ne=e=>{const{options:t}=window;0!==e.button&&2!==e.button||(e.preventDefault(),Z.isStroking&&T(),t.hideCross&&u("svgContainer").classList.remove("hidecursor"),window.removeEventListener("mouseup",Ne),window.removeEventListener("mousemove",Ie))},Pe=e=>{const{options:t}=window;if(0===e.button||2===e.button){if(Z.isStroking)return Ne(e);if(Te())return;e.preventDefault(),ee.rectangle=e.currentTarget.getBoundingClientRect();const o=e.pageX-ee.rectangle.left-pageXOffset,n=e.pageY-ee.rectangle.top-pageYOffset;if(e.altKey)H(e.button?1:0,g(o,n)),de();else{const a=0===e.button&&3!==se();t.hideCross&&u("svgContainer").classList.add("hidecursor"),Y(o,n,a),window.addEventListener("mouseup",Ne),window.addEventListener("mousemove",Ie)}}},Me=()=>E(-100,-100),_e=e=>{const{options:t}=window;ee.rectangle=e.currentTarget.getBoundingClientRect();const o=e.pageX-ee.rectangle.left-pageXOffset,n=e.pageY-ee.rectangle.top-pageYOffset;if(E(o,n),t.colorUnderCursorHint&&!Z.isStroking){const e=g(o,n);if(ee.stSeenColorToHighlight!==e){const t=u("colors").querySelector("b.hint");t&&t.classList.remove("hint");const o=Z.palette.indexOf(e);if(o>=0){u("colors").querySelectorAll("b")[o].classList.add("hint")}}ee.lastSeenColorToHighlight=e}},Be=()=>{if(!ee.touchSingle)return;const e=ee.lastTouch.pageX-ee.rectangle.left,t=ee.lastTouch.pageY-ee.rectangle.top;Y(e,t,!0),ee.touchSingle=!1},$e=e=>{if(1!==e.touches.length)return;if(Be(),e.preventDefault(),!Z.isStroking)return;const t=e.touches[0].pageX-ee.rectangle.left,o=e.touches[0].pageY-ee.rectangle.top;K(t,o)},je=e=>{0===e.touches.length&&(Be(),e.preventDefault(),window.removeEventListener("touchend",je),window.removeEventListener("touchmove",$e),T())},Oe=e=>{if(1===e.changedTouches.length&&1===e.touches.length){const{pageX:t,pageY:o}=e.changedTouches[0];Math.abs(t-ee.lastTouch.pageX)<10&&Math.abs(o-ee.lastTouch.pageY)<10&&(u("play").classList.remove("pause"),t<e.touches[0].pageX?X():z())}window.removeEventListener("touchend",Oe)},Ge=e=>{if(1===e.touches.length){if(Te())return;ee.rectangle=e.currentTarget.getBoundingClientRect(),ee.touchSingle=!0,ee.lastTouch=e.touches[0],window.addEventListener("touchend",je),window.addEventListener("touchmove",$e)}else ee.touchSingle&&3===e.touches.length&&(ee.lastTouch=e.touches[1],window.addEventListener("touchend",Oe)),ee.touchSingle=!1,window.removeEventListener("touchend",je),window.removeEventListener("touchmove",$e),Z.isStroking&&T()},ze=e=>{if(!Z.unsaved)return;const t="You haven't saved the drawing. Abandon?";return e.returnValue=t,t},Re=e=>{Z.isStroking&&e.preventDefault()},He=e=>alert(e),Ve=(e,t,o)=>{const{options:n}=window,a=new XMLHttpRequest;a.open(e,t),o.header&&a.setRequestHeader(o.header[0],o.header[1]),o.retry=5,a.timeout=15e3,a.ontimeout=()=>{if(o.retry>0){if(!n.retryEnabled)return;document.body.style.cursor="progress",o.retry--,Ve(e,t,o)}else document.body.style.cursor="",o.error()},a.onload=()=>{"/play/skip.json"!==t||"Sorry, but we couldn't find your current game."!==a.error?"/play/exit.json"!==t||"Sorry, but we couldn't find your current game."!==a.error?o.load(a.responseText):location.pathname="/":location.reload()},a.onerror=()=>{o.error?o.error(a):o.load(a)},o.obj?a.send(JSON.stringify(o.obj)):a.send(),document.body.style.cursor=""},Ue=e=>{e.preventDefault(),window.frameElement.ownerDocument.querySelector(".v--modal-overlay").outerHTML=""},qe=e=>{const t=document.createElement("textarea");return t.innerHTML=e,t.value},Ke=()=>{const{getLocalStorageItem:e}=window;u("bookmark").disabled=!0;const t=e("gpe_gameBookmarks",{}),o=window.gameInfo.caption;t[window.gameInfo.gameid]={time:Date.now(),caption:o?qe(o):""},localStorage.setItem("gpe_gameBookmarks",JSON.stringify(t))},Ye=e=>{13===e.keyCode&&(e.preventDefault(),u("submitcaption").click())},Xe=()=>{let e=(ee.timerStart-Date.now())/1e3;try{window.timerCallback&&window.timerCallback(e)}catch(e){}e=Math.abs(e);const t=`0${Math.floor(e/60)}`.slice(-2);e=`0${Math.floor(e%60)}`.slice(-2),u("timer").childNodes[0].nodeValue=`${t}:${e}`},Fe=()=>{const{incontest:e,gameInfo:t,drawing_aborted:o,vertitle:n}=window;e&&!o&&Ve("POST","/contests/exit.json",{load:()=>alert("You have missed your contest.")}),t.drawfirst&&!o&&Ve("POST","/play/abort-start.json",{obj:{game_token:t.gameid},load:()=>alert("You have missed your Draw First game.\nIt has been aborted."),error:()=>alert("You have missed your Draw First game.\nI tried aborting it, but an error occured. :(")}),ee.timerStart=Date.now(),u("newcanvasyo").className="sandbox",window.timerCallback=()=>{},Xe(),document.title="Sandbox - Drawception",u("gamemode").innerHTML="Sandbox",u("headerinfo").innerHTML=`Sandbox with ${n}`;try{history.replaceState({},null,"/sandbox/")}catch(e){}F()},Je=()=>{const{gameInfo:e,incontest:t}=window;if(t){if(!confirm("Quit the contest? Entry coins will be lost!"))return;return u("exit").disabled=!0,void Ve("POST","/contests/exit.json",{load:()=>{u("exit").disabled=!1,window.drawing_aborted=!0,Fe(),document.location.pathname="/contests/"},error:()=>{u("exit").disabled=!1,alert("Server error. :( Try again?")}})}if(e.drawfirst){if(!confirm("Abort creating a draw first game?"))return;return u("exit").disabled=!0,void Ve("POST","/play/abort-start.json",{obj:{game_token:e.gameid},load:()=>{u("exit").disabled=!1,window.drawing_aborted=!0,Fe(),document.location.pathname="/create/"},error:()=>{u("exit").disabled=!1,alert("Server error. :( Try again?")}})}confirm("Really exit?")&&(u("exit").disabled=!0,Ve("POST","/play/exit.json",{obj:{game_token:e.gameid},load:()=>{u("exit").disabled=!1,Fe()}}))},We=e=>{e.preventDefault(),window.top.location.href="https://drawception.com/"},Qe=e=>{const t=document.implementation.createHTMLDocument("");t.body.innerHTML=e;const o=t.querySelector("draw-app")||t.querySelector("describe")||{getAttribute:()=>!1},n=e=>t.querySelector(e);return{error:(e=>!!e&&e.src)(n(".error")),gameid:o.getAttribute("game_token"),blitz:"true"===o.getAttribute(":blitz_mode"),nsfw:"true"===o.getAttribute(":nsfw"),friend:"true"!==o.getAttribute(":game_public"),drawfirst:"true"===o.getAttribute(":draw_first"),timeleft:1*o.getAttribute(":seconds"),caption:o.getAttribute("phrase"),image:o.getAttribute("img_url"),palette:o.getAttribute("theme_id"),bgbutton:"true"===o.getAttribute(":bg_layer"),playerurl:"/profile/",avatar:null,coins:"-",pubgames:"-",friendgames:"-",notifications:"-",drawinglink:(e=>!!e&&e.src)(n(".gamepanel img")),drawingbylink:(e=>!!e&&[e.textContent.trim(),e.href])(n("#main p a")),drawncaption:(e=>!!e&&e.src)(n("h1.game-title")),notloggedin:null!==n("form.form-login"),limitreached:!1,html:e}},Ze={default:["Normal","#fffdc9"],theme_thanksgiving:["Thanksgiving","#f5e9ce"],halloween:["Halloween","#444444"],theme_cga:["CGA","#ffff55"],shades_of_grey:["Grayscale","#e9e9e9"],theme_bw:["Black and white","#ffffff"],theme_gameboy:["Gameboy","#9bbc0f"],theme_neon:["Neon","#00abff"],theme_sepia:["Sepia","#ffe2c4"],theme_valentines:["Valentine's","#ffccdf"],theme_blues:["the blues","#295c6f"],theme_spring:["Spring","#ffffff"],theme_beach:["Beach","#f7dca2"],theme_beach_2:["Tide Pool","#2271a2"],theme_coty_2016:["Colors of 2016","#648589"],theme_bee:["Bee","#ffffff"],theme_coty_2017:["Colors of 2017","#5f7278"],theme_fire_ice:["Fire and Ice","#040526"],theme_coty_2018:["Canyon Sunset","#2e1b50"],theme_juice:["Juice","#fced95"],theme_tropical:["Tropical","#2f0946"],theme_grimby_grays:["Grimby Grays","#f0efeb"],theme_fury_road:["Fury Road","#893f1d"],theme_candy:["Candy","#793abd"],theme_holiday_2:["Holiday","#f6f6f6"],theme_blues_2:["Blues","#0f1328"],theme_sin_city:["Sin City","#000000"],theme_lucky_clover:["Lucky Clover","#0c442c"],theme_drawception:["D's Exclusive","#0ee446"],theme_retina_burn:["Retina Burn","#ff0b11"],theme_easter:["Easter","#ddf7a8"],theme_neapolitan:["Neapolitan","#fff7e1"],theme_lemonade:["Lemonade","#ffebaa"],theme_school_pen:["School Pen","#fbfcfd"]},et=()=>{const{gameInfo:e,inforum:t}=window;if(e.notloggedin)return u("start").parentNode.innerHTML='<a href="/login" class="headerbutton active">Login</a> <a href="/register" class="headerbutton active">Register</a>';e.avatar&&(u("infoavatar").src=e.avatar),u("infoprofile").href=e.playerurl,u("infocoins").innerHTML=e.coins,u("infogames").innerHTML=e.pubgames,u("infofriendgames").innerHTML=e.friendgames||0,u("infonotifications").innerHTML=e.notifications,t&&(document.querySelector(".headerright").hidden=!0)},tt=e=>{const{gameInfo:t}=window;e<1?(document.title="[TIME'S UP!] Playing Drawception",t.image||window.timesup?window.submitting||(t.image?nt():Fe()):(u("newcanvasyo").classList.add("locked"),I(),ee.timerStart+=15e3,Xe(),window.timesup=!0)):document.title=`[${`0${Math.floor(e/60)}`.slice(-2)}:${`0${Math.floor(e%60)}`.slice(-2)}] Playing Drawception`,window.alarm&&!window.playedWarningSound&&e<=(t.blitz?5:61)&&e>0&&(window.alarm.play(),window.playedWarningSound=!0)},ot=()=>{const{options:e,gameInfo:o,incontest:n,vertitle:a}=window;if(u("skip").disabled=o.drawfirst||n,u("report").disabled=o.drawfirst||n,u("exit").disabled=!1,u("start").disabled=!1,u("bookmark").disabled=o.drawfirst||n,u("options").disabled=!0,u("timeplus").disabled=n,u("submit").disabled=!1,u("headerinfo").innerHTML=`Playing with ${a}`,u("drawthis").classList.add("onlyplay"),u("emptytitle").classList.remove("onlyplay"),window.submitting=!1,window.drawing_aborted=!1,o.error)return alert(`Play Error:\n${o.error}`),Fe();if(o.limitreached)return alert("Play limit reached!"),Fe();u("gamemode").innerHTML=n?"Contest":`${(o.friend?"Friend ":"Public ")+(o.nsfw?"Not Safe For Work (18+) ":"safe for work ")+(o.blitz?"BLITZ ":"")}Game`,u("drawthis").innerHTML=o.caption||o.drawfirst&&"(Start your game!)"||"",u("tocaption").src="";const r=u("newcanvasyo");r.className="play",o.friend&&r.classList.add("friend"),u("palettechooser").className=o.friend?"":"onlysandbox",o.nsfw&&r.classList.add("nsfw"),o.blitz&&r.classList.add("blitz"),r.classList.add(o.image?"captioning":"drawing"),Z.isStroking&&T(),F();for(let e=Z.svg.childNodes.length-1;e>0;e--)Z.svg.removeChild(Z.svg.childNodes[e]);G(0),t(1),Z.unsaved=!1;const{palette:i}=o;if(o.image)u("tocaption").src=o.image.length<=30?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAD6AQMAAAAho+iwAAAABlBMVEWAQED///94jotxAAABiklEQVR4Xu3W0UrCUBjA8eOO5CLK7VxLzDWFrjK6Eaha8FHuppfwBRJvdjlMIK/K3qA3OZBBd/UIm9UL2O2inMJBptNuog/6/h4Q2Y8J387Y2KIoiqIoiqIoiuIxXnbI5cmXSiJjD3LmFyrGY46PqVAx/HPDv9/w3wsJTTgapuDkcEIQMFxzo937S8+F5OkWI2IKymQl3yiZ6j8zYsRY6vUYDcOfGkuMknE5/aQAMczX9O+iKIrKJWuSxliQqT61hOmMucsYK6uzLWfDenF34EXhOX+s377KLCZcs1bxhNXQqnAvrExWM8vvY3amORCNsplu2nZPWKdj1tecTHZZLA97ZnjBB/XrkWIZWT+bsmTowp+7FHSnyMi7CpuMrWcwNsMMxnJzrCUbwwq/2/MLJb8lP4L2zVHJ35Bp1rE8Uc2bALoNHQvcoNG3Yf5Pm6EnHG50Ye0YmiG4V08LmWD7wmF9gJwFgoHbnZzNSDE/Co3orSB2YGsbovAgaD9vlkB/WbkbdQVWMNxR1Ddnf4eSZpHZYAAAAABJRU5ErkJggg==":o.image,u("caption").value="",u("caption").focus(),u("caption").setAttribute("maxlength",45),u("usedchars").textContent="45";else{const e=(e=>{if("theme_roulette"===e){alert("Warning: Drawception roulette didn't give a theme. ANBT will choose a random palette."),delete Q.Roulette;const e=Object.keys(Ze),t=e[e.length*Math.random()<<0];return Q.Roulette=Q[Ze[t][0]],["Roulette",Ze[t][1]]}if(e)return Ze[e.toLowerCase()]})(i);e?(Se(e[0]),b(e[1]),Z.color=[Q[e[0]][0],"eraser"],de()):(i?alert(`Error, please report! Unknown palette: '${i}'.\nAre you using the latest ANBT version?`):alert("Error, please report! Failed to extract the palette.\nAre you using the latest ANBT version?"),u("submit").disabled=!0),u("setbackground").hidden=!o.bgbutton}(e.timeoutSound&&!o.blitz||e.timeoutSoundBlitz&&o.blitz)&&(window.playedWarningSound=!1,window.alarm=new Audio(window.alarmSoundOgg),window.alarm.volume=e.timeoutSoundVolume/100),ee.timerStart=Date.now()+1e3*o.timeleft,window.timerCallback=tt,et(),window.timesup=!1,Xe()},nt=()=>{const{incontest:e,friendgameid:t}=window,o=e?"/contests/play/":`/play/${t?`${t}/`:""}`;try{location.pathname!==o&&history.replaceState({},null,o)}catch(e){}Ve("GET",`${o}?${Date.now()}`,{load:e=>{window.gameInfo=e?Qe(e):{error:"Server returned a blank response :("},ot()},error:e=>{window.gameInfo={error:`Server error: ${e.statusText}`},ot()}})},at=()=>{confirm("Report this panel?")&&Ve("POST","/play/flag.json",{obj:{game_token:window.gameInfo.gameid},load:()=>{u("report").disabled=!1,nt()}})},rt=()=>Z.unsaved&&!confirm("You haven't saved the drawing. Abandon?"),it=()=>{rt()||(u("skip").disabled=!0,Ve("POST","/play/skip.json",{obj:{game_token:window.gameInfo.gameid},load:()=>nt(),error:()=>{u("skip").disabled=!1,nt()}}))},st=()=>{rt()||(u("start").disabled=!0,nt())},dt=()=>{const{incontest:e,gameInfo:t}=window,o=u("caption").value;if(!o)return u("caption").focus(),alert("You haven't entered a caption!");window.submitting=!0,u("submitcaption").disabled=!0,Ve("POST",e?"/contests/submit-caption.json":"/play/describe.json",{obj:{game_token:t.gameid,title:o},load:e=>{try{e=JSON.parse(e)}catch(t){e={error:e}}e.error?(u("submitcaption").disabled=!1,"object"==typeof e.error?alert(`Error! Please report this data:\ngame: ${t.gameid}\n\nresponse: \n${JSON.stringify(e.error)}`):alert(e.error)):e.message?(u("submitcaption").disabled=!1,alert(e.message)):e.url&&((e=>{const{options:t,gameInfo:o}=window;if(!t.bookmarkOwnCaptions)return;const n=window.getLocalStorageItem("gpe_gameBookmarks",{});n[o.gameid]={time:Date.now(),caption:`"${e}"`,own:!0},localStorage.setItem("gpe_gameBookmarks",JSON.stringify(n))})(o),Z.unsaved=!1,location.replace(e.url))},error:()=>{u("submitcaption").disabled=!1,alert("Server error. :( Try again?")}})},lt=()=>{const{incontest:e,gameInfo:t,options:o}=window,n=ee.timerStart-Date.now()>6e4;o.submitConfirm&&n&&!confirm("Ready to submit this drawing?")||(u("submit").disabled=!0,B(300,250,!0),o.backup&&localStorage.setItem("anbt_drawingbackup_newcanvas",Z.pngBase64),window.submitting=!0,Ve("POST",e?"/contests/submit-drawing.json":"/play/draw.json",{obj:{game_token:t.gameid,panel:Z.pngBase64},load:e=>{try{e=JSON.parse(e)}catch(t){e={error:e}}e.error?(u("submit").disabled=!1,"object"==typeof e.error?alert(`Error! Please report this data:\ngame: ${t.gameid}\n\nresponse:\n${JSON.stringify(e.error)}`):alert(e.error)):e.message?(u("submit").disabled=!1,alert(e.message)):e.url&&(window.onbeforeunload=()=>{},Z.unsaved=!1,location.replace(e.url))},error:()=>{u("submit").disabled=!1,alert("Server error. :( Try again?")}}))},ct=()=>{let{gameInfo:e}=window;e.friend&&(u("timeplus").disabled=!0,Ve("POST","/play/exit.json",{obj:{game_token:e.gameid},load:()=>{Ve("GET",`/play/${e.gameid}/?${Date.now()}`,{load:t=>{u("timeplus").disabled=!1,e=t?Qe(t):{error:"Server returned a blank response :("},ee.timerStart=Date.now()+1e3*e.timeleft},error:()=>{u("timeplus").disabled=!1,alert("Server error. :( Try again?")}})},error:()=>{u("timeplus").disabled=!1,alert("Server error. :( Try again?")}}))},ft=()=>{u("usedchars").textContent=45-u("caption").value.length},ut=()=>{const{gameInfo:e,vertitle:t,options:o}=window;if(e.drawingbylink){const[t,n]=e.drawingbylink,a=`<a href="http://grompe.org.ru/drawit/#drawception/${location.hash.substr(1)}" title="Public replay link for sharing">Drawing</a>`;u("headerinfo").innerHTML=`${a} by <a href="${n}">${t}</a>`,document.title=`${t}'s drawing - Drawception`,e.drawncaption&&(u("drawthis").innerHTML=`"${e.drawncaption}"`,u("drawthis").classList.remove("onlyplay"),u("emptytitle").classList.add("onlyplay")),o.autoplay&&O()}else u("headerinfo").innerHTML=`Sandbox with ${t}`,u("drawthis").classList.add("onlyplay");et()};window.needToGoDeeper=()=>{const{options:e,insandbox:t,panelid:o}=window;if(window.onerror=(e,t,o)=>{e.toString().includes("periodsToSeconds")||e.toString().match(/script error/i)||alert(o?`${e}\nline: ${o}`:e)},e.newCanvasCSS){const t=document.getElementsByTagName("head")[0]||document.documentElement,o=document.createElement("style");o.type="text/css";const n=document.createTextNode(e.newCanvasCSS);o.appendChild(n),t.appendChild(o)}if(e.enableWacom){const t=document.createElement("object"),o=u("wacomContainer");t.setAttribute("id","wacom"),t.setAttribute("type","application/x-wacomtabletplugin"),t.setAttribute("width","1"),t.setAttribute("height","1"),o.appendChild(t),e.fixTabletPluginGoingAWOL&&(()=>{const e=u("wacom"),t=u("wacomContainer");window.onblur=()=>{1===t.childNodes.length&&t.removeChild(e)},window.onfocus=()=>{0===t.childNodes.length&&t.appendChild(e)}})()}if((()=>{const{options:e,inforum:t}=window;if(t){u("quit").addEventListener("click",We);const e=document.createElement("button");e.href="/",e.setAttribute("class","submit exit"),e.title="Exit",e.textContent="Exit",e.addEventListener("click",Ue),u("submit").parentNode.insertBefore(e,u("submit").nextSibling)}u("exit").addEventListener("click",Je),u("skip").addEventListener("click",it),u("start").addEventListener("click",st),u("report").addEventListener("click",at),u("bookmark").addEventListener("click",Ke),u("submit").addEventListener("click",lt),u("submitcaption").addEventListener("click",dt),e.enterToCaption&&u("caption").addEventListener("keydown",Ye),u("caption").addEventListener("change",ft),u("caption").addEventListener("keydown",ft),u("caption").addEventListener("input",ft),u("timeplus").addEventListener("click",ct)})(),t){if(o)Ve("GET",`/panel/drawing/${o}/-/`,{load:e=>{window.gameInfo=Qe(e),A(`${window.gameInfo.drawinglink}?anbt`),ut()},error:()=>{alert("Error loading the panel page. Please try again.")}});else if(Ve("GET","/sandbox/",{load:e=>{window.gameInfo=Qe(e),ut()},error:()=>{}}),e.backup){const e=localStorage.getItem("anbt_drawingbackup_newcanvas");e&&(S(J(e.substr(22)).buffer),localStorage.removeItem("anbt_drawingbackup_newcanvas"))}}else u("newcanvasyo").className="play",nt();/iPad|iPhone/.test(navigator.userAgent)&&(Z.fastUndoLevels=3),window.$=()=>{throw alert("Some additional script conflicts with ANBT new canvas, please disable it."),window.$=null,new Error("Script conflict with ANBT new canvas")}},window.options||(window.options={}),Z.bindContainer(u("svgContainer")),u("svgContainer").addEventListener("mousedown",Pe),u("svgContainer").addEventListener("mousemove",_e),u("svgContainer").addEventListener("touchstart",Ge),u("svgContainer").addEventListener("mouseleave",Me),u("svgContainer").addEventListener("contextmenu",De),u("import").addEventListener("click",me),u("export").addEventListener("click",he),u("imgur").addEventListener("click",be),document.querySelectorAll(".brush").forEach((e,t)=>{e.classList.add(`size-${ee.brushSizes[t]}`),e.addEventListener("mousedown",te),e.addEventListener("click",te)}),u("colors").querySelectorAll("b").forEach(e=>{e.addEventListener("mousedown",le),e.addEventListener("touchend",le),e.addEventListener("contextmenu",Le)}),u("setbackground").addEventListener("click",ae),u("undo").addEventListener("click",ie),u("redo").addEventListener("click",oe),u("trash").addEventListener("click",re),V(ke),u("knob").addEventListener("mousedown",ye),u("knob").addEventListener("touchstart",ye),u("seekbar").addEventListener("mousedown",ye),u("seekbar").addEventListener("touchstart",ye),u("play").addEventListener("mousedown",ce),u("play").addEventListener("touchstart",ce),u("palettename").addEventListener("mousedown",xe),u("palettename").addEventListener("touchend",xe),u("popupclose").addEventListener("click",Ee),document.addEventListener("keyup",pe),document.addEventListener("keydown",ue),window.addEventListener("contextmenu",Re),window.addEventListener("error",He),window.addEventListener("beforeunload",ze),ee.timerStart=Date.now(),setInterval(Xe,500),window.anbtReady&&window.anbtReady()}();
